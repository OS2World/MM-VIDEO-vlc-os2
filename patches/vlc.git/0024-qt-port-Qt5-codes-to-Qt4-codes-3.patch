From 0c1bfddc226051c0069a7caac3fb01115526e69a Mon Sep 17 00:00:00 2001
From: KO Myung-Hun <komh@chollian.net>
Date: Mon, 28 May 2018 19:41:01 +0900
Subject: [PATCH 24/24] qt: port Qt5 codes to Qt4 codes #3

---
 modules/gui/qt/components/custom_menus.cpp |  4 ++++
 modules/gui/qt/dialogs_provider.cpp        | 27 +++++++++++++++++++++++++++
 2 files changed, 31 insertions(+)

diff --git a/modules/gui/qt/components/custom_menus.cpp b/modules/gui/qt/components/custom_menus.cpp
index 232a7aea7a..3988b10c98 100644
--- a/modules/gui/qt/components/custom_menus.cpp
+++ b/modules/gui/qt/components/custom_menus.cpp
@@ -37,7 +37,11 @@
 #include <QProgressBar>
 
 RendererAction::RendererAction( vlc_renderer_item_t *p_item_ )
+#if HAS_QT5
     : QAction()
+#else
+    : QAction(nullptr)
+#endif
 {
     p_item = p_item_;
     vlc_renderer_item_hold( p_item );
diff --git a/modules/gui/qt/dialogs_provider.cpp b/modules/gui/qt/dialogs_provider.cpp
index 93cc890c8d..6005737cc2 100644
--- a/modules/gui/qt/dialogs_provider.cpp
+++ b/modules/gui/qt/dialogs_provider.cpp
@@ -394,8 +394,16 @@ void DialogsProvider::openFileGenericDialog( intf_dialog_args_t *p_arg )
     }
     else /* non-save mode */
     {
+#if HAS_QT5
         QList<QUrl> urls = QFileDialog::getOpenFileUrls( NULL, qfu( p_arg->psz_title ),
                                        p_intf->p_sys->filepath, extensions );
+#else
+        QStringList files = QFileDialog::getOpenFileNames( NULL, qfu( p_arg->psz_title ),
+                                       p_intf->p_sys->filepath.toLocalFile(), extensions );
+        QList<QUrl> urls;
+        foreach( const QString &file, files )
+            urls.append( QUrl::fromLocalFile( file ) );
+#endif
         p_arg->i_results = urls.count();
         p_arg->psz_results = (char **)vlc_alloc( p_arg->i_results, sizeof( char * ) );
         i = 0;
@@ -484,10 +492,22 @@ QStringList DialogsProvider::showSimpleOpen( const QString& help,
     fileTypes.replace( ";*", " *");
     fileTypes.chop(2); //remove trailling ";;"
 
+#if HAS_QT5
     QList<QUrl> urls = QFileDialog::getOpenFileUrls( NULL,
         help.isEmpty() ? qtr(I_OP_SEL_FILES ) : help,
         path.isEmpty() ? p_intf->p_sys->filepath : path,
         fileTypes );
+#else
+    QStringList files = QFileDialog::getOpenFileNames( NULL,
+        help.isEmpty() ? qtr(I_OP_SEL_FILES ) : help,
+        path.isEmpty() ? p_intf->p_sys->filepath.toLocalFile()
+                       : path.toLocalFile(),
+        fileTypes );
+
+    QList<QUrl> urls;
+    foreach( const QString &file, files )
+        urls.append( QUrl::fromLocalFile( file ) );
+#endif
 
     if( !urls.isEmpty() )
         p_intf->p_sys->filepath = urls.last();
@@ -792,7 +812,14 @@ void DialogsProvider::loadSubtitlesFile()
     if( path )
     {
         url.setUrl( qfu(path) );
+#if HAS_QT5
         url = url.adjusted(QUrl::RemoveFilename);
+#else
+        QString urlpath = url.path();
+        int slash = urlpath.lastIndexOf('/');
+        urlpath.remove(slash + 1, urlpath.length());
+        url.setPath(urlpath);
+#endif
         if (url.scheme() != "file")
             url.clear();
         free(path);
-- 
2.13.3

